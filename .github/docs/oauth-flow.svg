<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1005.2399749755859 1093.0499854579568" width="1005.2399749755859" height="1093.0499854579568" filter="invert(93%) hue-rotate(180deg)">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
    
  </defs>
  <rect x="0" y="0" width="1005.2399749755859" height="1093.0499854579568" fill="#ffffff"></rect><g transform="translate(10 18) rotate(0 20.879974365234375 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">user</text></g><g transform="translate(311 10) rotate(0 25.629974365234375 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">client</text></g><g transform="translate(655 18) rotate(0 32.77997589111328 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">tenant</text></g><g transform="translate(958 11) rotate(0 18.61998748779297 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API</text></g><g transform="translate(421 89.86022267806425) rotate(0 97.51702880859375 19.81917482680859)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="15.855339861446868px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">client makes request to </text><text x="0" y="19.819174826808585" font-family="Virgil, Segoe UI Emoji" font-size="15.855339861446868px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">protected API endpoint</text></g><g transform="translate(489 208) rotate(0 203.28250122070312 20.469520758453427)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16.375616606762733px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API returns 401 if the request sent by the client</text><text x="0" y="20.469520758453417" font-family="Virgil, Segoe UI Emoji" font-size="16.375616606762733px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">doesn't contain valid JWT encoded access token</text></g><g transform="translate(75 212) rotate(0 122.70735168457031 41.097300613574475)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16.438920245429788px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">client checks whether it has </text><text x="0" y="20.548650306787234" font-family="Virgil, Segoe UI Emoji" font-size="16.438920245429788px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">valid refresh token to obtain </text><text x="0" y="41.09730061357447" font-family="Virgil, Segoe UI Emoji" font-size="16.438920245429788px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">new access token from the </text><text x="0" y="61.6459509203617" font-family="Virgil, Segoe UI Emoji" font-size="16.438920245429788px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">tenant</text></g><g transform="translate(339.4762775188665 358.1758145041945) rotate(0 172.83746337890625 31.371154800784893)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16.731282560418606px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">if no valid tokens are found, the client </text><text x="0" y="20.914103200523257" font-family="Virgil, Segoe UI Emoji" font-size="16.731282560418606px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">sends authorization request to tenant's </text><text x="0" y="41.828206401046515" font-family="Virgil, Segoe UI Emoji" font-size="16.731282560418606px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">/oauth2/authorize endpoint</text></g><g transform="translate(78 462.5384533169479) rotate(0 269.74102783203125 11.23077334152606)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="17.969237346441734px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">tenant redirects the request to login UI where user signs in</text></g><g transform="translate(348 565) rotate(0 160.11441040039062 21.56593123199042)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="17.25274498559233px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">tenant redirects user back to client </text><text x="0" y="21.56593123199041" font-family="Virgil, Segoe UI Emoji" font-size="17.25274498559233px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">with one-time authorization code</text></g><g transform="translate(343 683) rotate(0 161.79251098632812 32.41431368231002)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="17.287633963898692px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">client sends token request containing </text><text x="0" y="21.609542454873363" font-family="Virgil, Segoe UI Emoji" font-size="17.287633963898692px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">the code to tenant's /oauth2/token </text><text x="0" y="43.21908490974673" font-family="Virgil, Segoe UI Emoji" font-size="17.287633963898692px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">endpoint</text></g><g transform="translate(401 825) rotate(0 107.8396224975586 21.339530567595943)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="17.071624454076733px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">tenant returns new JWT </text><text x="0" y="21.339530567595915" font-family="Virgil, Segoe UI Emoji" font-size="17.071624454076733px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">after PKCE checks</text></g><g transform="translate(403 936) rotate(0 241.11419677734375 11.390126488867395)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="18.224202382187787px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">client makes new request with the valid access token</text></g><g stroke-linecap="round"><g transform="translate(334 58) rotate(0 -5.4745221845805645 507.73962811157105)"><path d="M1.14 -1.06 C-0.76 168.52, -10.04 846.84, -12.09 1016.54" stroke="#1e1e1e" stroke-width="1.5" fill="none" stroke-dasharray="8 9"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(684.9721648461978 66.26037188842889) rotate(0 -5.856061065942072 508.0762859113514)"><path d="M-0.64 -0.24 C-2.42 169.17, -9.29 847.04, -11.07 1016.4" stroke="#1e1e1e" stroke-width="1.5" fill="none" stroke-dasharray="8 9"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(980.9721648461978 62.26037188842895) rotate(0 -6.396891593188002 508.8459052197635)"><path d="M-0.73 0.9 C-2.84 170.43, -10.29 847.65, -12.06 1016.79" stroke="#1e1e1e" stroke-width="1.5" fill="none" stroke-dasharray="8 9"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(32.9721648461977 66.26037188842895) rotate(0 -5.4965186722576505 507.9471714504063)"><path d="M-0.18 -0.9 C-2.07 168.39, -9.01 847.17, -10.81 1016.79" stroke="#1e1e1e" stroke-width="1.5" fill="none" stroke-dasharray="8 9"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(337 142) rotate(0 319.896318269521 2.1558007053146184)"><path d="M-0.3 -0.53 C106.26 0, 533.33 2.84, 640.1 3.89 M1.74 1.81 C108.09 2.39, 532.88 4.51, 639.2 4.84" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(337 142) rotate(0 319.896318269521 2.1558007053146184)"><path d="M610.08 15.14 C619.2 11.87, 632.45 6.53, 640.72 4.02 M610.56 15.13 C619.34 13.04, 626.31 10.02, 639.48 5.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(337 142) rotate(0 319.896318269521 2.1558007053146184)"><path d="M610.17 -5.38 C619.37 -1.28, 632.59 0.76, 640.72 4.02 M610.64 -5.4 C619.42 -1.84, 626.36 0.77, 639.48 5.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(978 189) rotate(0 -320.35388752527996 -0.19175951406361946)"><path d="M0.28 0.97 C-106.49 0.9, -533.48 -1.2, -640.37 -1.35 M-1.03 0.43 C-107.92 0.61, -534.18 0.36, -640.99 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(978 189) rotate(0 -320.35388752527996 -0.19175951406361946)"><path d="M-611.17 -9.16 C-622.43 -7.01, -629.03 -2.5, -642.89 0.87 M-613.14 -10.8 C-622.65 -6.26, -633.96 -3.14, -641.38 0.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(978 189) rotate(0 -320.35388752527996 -0.19175951406361946)"><path d="M-611.2 11.36 C-622.3 6.96, -628.88 4.94, -642.89 0.87 M-613.18 9.72 C-622.7 6.5, -634 1.86, -641.38 0.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(334 203) rotate(0 -0.5404573106486623 58.195157679738486)"><path d="M-1.1 -0.05 C-1.17 19.31, -0.94 96.95, -0.77 116.33 M0.52 -1.12 C0.35 18.36, -1.45 97.8, -1.6 117.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334 203) rotate(0 -0.5404573106486623 58.195157679738486)"><path d="M-11.49 89.53 C-9.85 98.32, -7.4 104.09, -2.26 117.95 M-11.06 88.88 C-7.14 98.61, -3.97 107.09, -1.59 118.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334 203) rotate(0 -0.5404573106486623 58.195157679738486)"><path d="M9.03 89.86 C5.16 98.37, 2.11 104.05, -2.26 117.95 M9.46 89.21 C6.6 98.78, 3.01 107.15, -1.59 118.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(333 333) rotate(0 171.24885995202027 -0.6871490407779675)"><path d="M0.67 0.04 C57.42 -0.29, 283.82 -1.31, 340.81 -1.41 M-0.44 -0.99 C56.63 -1.25, 285.82 -0.71, 342.93 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(333 333) rotate(0 171.24885995202027 -0.6871490407779675)"><path d="M314.77 7.86 C322.11 7.4, 332.75 2.89, 340.99 1.5 M315.14 9.68 C325.94 5.27, 336.76 1.25, 343.03 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(333 333) rotate(0 171.24885995202027 -0.6871490407779675)"><path d="M314.84 -12.66 C322.25 -6.39, 332.86 -4.18, 340.99 1.5 M315.2 -10.84 C326.12 -7.32, 336.91 -3.41, 343.03 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(674.3538875252798 443.1917595140635) rotate(0 -320.7868643076811 -0.11699607430955439)"><path d="M-0.85 -0.69 C-107.7 -0.88, -534.79 -0.14, -641.35 -0.13 M0.9 1.56 C-106.1 0.96, -535.57 -1.07, -642.48 -1.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(674.3538875252798 443.1917595140635) rotate(0 -320.7868643076811 -0.11699607430955439)"><path d="M-615.38 -12.47 C-620.51 -7.96, -629.18 -5.92, -642.2 -2.05 M-614.23 -11.59 C-626.3 -6.92, -635.91 -2.78, -642.03 -2.05" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(674.3538875252798 443.1917595140635) rotate(0 -320.7868643076811 -0.11699607430955439)"><path d="M-615.5 8.05 C-620.76 6.89, -629.4 3.25, -642.2 -2.05 M-614.34 8.93 C-626.48 5.41, -636.04 1.36, -642.03 -2.05" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(33.10368173047914 499.8441992946855) rotate(0 319.687061216901 3.0563885811017713)"><path d="M0.81 -0.68 C107.5 0.21, 532.86 4.29, 639.59 5.17 M-0.22 1.58 C106.32 2.71, 531.55 6.1, 638.43 6.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(33.10368173047914 499.8441992946855) rotate(0 319.687061216901 3.0563885811017713)"><path d="M609.03 16.17 C617.74 16.05, 624.1 9.86, 637.69 5.79 M609.32 17.21 C618.73 14.04, 626.3 10.21, 638.08 7.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(33.10368173047914 499.8441992946855) rotate(0 319.687061216901 3.0563885811017713)"><path d="M609.18 -4.35 C617.82 0.82, 624.14 -0.08, 637.69 5.79 M609.47 -3.31 C618.95 -0.82, 626.48 1.02, 638.08 7.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(676.7511400479798 540.6871490407777) rotate(0 -172.31795970683186 -0.9772858444645749)"><path d="M0.66 0.26 C-56.79 0.07, -286.69 -1.63, -344.25 -2.21 M-0.45 -0.66 C-58.12 -0.54, -287.74 -0.33, -345.3 -0.61" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(676.7511400479798 540.6871490407777) rotate(0 -172.31795970683186 -0.9772858444645749)"><path d="M-316.67 -11.14 C-326.57 -8.24, -337.84 -5.56, -346.57 -2.56 M-316.11 -10.92 C-325.03 -8.3, -332.57 -4.59, -345.34 -1.45" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(676.7511400479798 540.6871490407777) rotate(0 -172.31795970683186 -0.9772858444645749)"><path d="M-316.7 9.39 C-326.41 5.31, -337.66 1.01, -346.57 -2.56 M-316.14 9.6 C-325.21 6.2, -332.73 3.9, -345.34 -1.45" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(332.7511400479797 660.6871490407779) rotate(0 170.78428887293467 -0.5961972642734281)"><path d="M0.94 0.13 C57.98 -0.29, 284.93 -1.08, 341.59 -1.32 M-0.03 -0.85 C56.88 -0.64, 283.25 -0.35, 340.47 -0.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(332.7511400479797 660.6871490407779) rotate(0 170.78428887293467 -0.5961972642734281)"><path d="M312.48 9.37 C317.48 5.48, 324.42 3.01, 341.93 -0.68 M312.95 9.02 C322.9 6.46, 332.4 2.68, 339.93 -0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(332.7511400479797 660.6871490407779) rotate(0 170.78428887293467 -0.5961972642734281)"><path d="M312.5 -11.15 C317.7 -9.97, 324.64 -7.38, 341.93 -0.68 M312.97 -11.5 C322.84 -6.87, 332.34 -3.47, 339.93 -0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(673.3179597068317 798.9772858444646) rotate(0 -171.59746738492714 1.5031866822440065)"><path d="M-0.17 1.06 C-57.04 1.16, -285.03 1.08, -342.08 1.51 M-1.72 0.57 C-58.67 0.7, -286.07 2.23, -343.03 2.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(673.3179597068317 798.9772858444646) rotate(0 -171.59746738492714 1.5031866822440065)"><path d="M-313.12 -7.99 C-323.17 -6.31, -326.02 -2.09, -345 4.19 M-314.6 -7.63 C-323.23 -4.35, -332.05 -1.97, -343.95 3.19" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(673.3179597068317 798.9772858444646) rotate(0 -171.59746738492714 1.5031866822440065)"><path d="M-313.01 12.53 C-323.24 9.53, -326.12 9.07, -345 4.19 M-314.49 12.89 C-323.1 10.16, -331.95 6.53, -343.95 3.19" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(331.10368173047914 915.8441992946855) rotate(0 320.16366726757497 1.7671541909594453)"><path d="M1.19 0.12 C107.78 0.7, 533.36 2.55, 639.98 2.91 M0.35 -0.86 C106.75 -0.04, 532.31 3.72, 639.01 4.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(331.10368173047914 915.8441992946855) rotate(0 320.16366726757497 1.7671541909594453)"><path d="M610.95 14.4 C620.1 12.25, 628.49 8.2, 638.45 4.7 M611.73 14.03 C617.96 12.54, 625.87 9.09, 638.88 4.57" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(331.10368173047914 915.8441992946855) rotate(0 320.16366726757497 1.7671541909594453)"><path d="M611.1 -6.12 C620.11 -1.4, 628.44 1.42, 638.45 4.7 M611.88 -6.49 C618 -2.42, 625.86 -0.32, 638.88 4.57" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg>